<apex:page standardController="Account"
    extensions="AOAccountDashboardCtl" sidebar="false" showHeader="false">

    <head>
    <!-- sidebar="false" header="false" -->
    <script type='text/javascript' src='https://www.google.com/jsapi' />  
   <script src="/soap/ajax/19.0/connection.js" type="text/javascript" />  
   <script type="text/javascript">  

   // use this function to format the label  
     formatCurrencyLabel = function( value )  
     {  
       return "$" + String(value);  
     }  
     google.load("visualization", "1", {packages:["corechart"]});  
     google.setOnLoadCallback(drawChart);  

    function drawChart() {  
         // Create a new data table with two columns: the label and the value  
         var data = new google.visualization.DataTable();  
         data.addColumn('string', 'Product Family');  
         data.addColumn('number', 'Sales');  
    
         // We need the sessionId to be able to query data  
        sforce.connection.sessionId = '{!$Api.Session_ID}';  
        // Query data using SOQL.  
        
         var result = sforce.connection.query("Select Product_Team__r.Name , sum( Net_Sales__c) netSales "+
                                              " From Sales__c s "+
                                              " where account__c in ({!allAccountsString})"+
                                              " and Year__c > {!LASTYEAR} " +
                                              " and SalesType__c = 'T' " +
                                              " group by Product_Team__r.Name ");  
         // Iterate over the result  
         
         var it = new sforce.QueryResultIterator(result); 
         
         while(it.hasNext()) {
             var record = it.next();  
             // Add the data to the table 
             var name = record.Name==""?"BLANK":record.Name; 
            data.addRow([name, {v:parseFloat(record.netSales), f: formatCurrencyLabel(record.netSales)}]);  
         }   
         var chart = new google.visualization.PieChart(document.getElementById('chart_div'));  
         chart.draw(data, {chartArea:{left:10,top:30,width:"90%",height:"90%"}, pieSliceText:'label', width: 300, height: 200, title: 'YTD Sales by Product Mix', is3D: true, legend:'right'});  
     }  
     
   </script>  
   </head>  
   
   
   <!--  Parent Account Info -->
    <apex:pageBlock id="mainBlock"  mode="maindetail"> 
       <apex:pageBlockSection id="accountHeaderSection" >
       <apex:outputPanel layout="block" style="float:right;">
       <table width="800" cellpadding="2">
         <tr>
            <td width="500"><b><apex:outputLabel value="Account Name"/></b>&nbsp;&nbsp;&nbsp;&nbsp;<apex:outputField id="accountName" value="{!parentAccount.Name}"/></td>
            <td align="right"><apex:image id="theImage" value="/servlet/servlet.FileDownload?file={!AoLogoId}" width="200" style="float:right;"/></td>
         </tr>
         <tr>
            <td width="500"><b><apex:outputLabel value="Customer Base"/></b>&nbsp;&nbsp;&nbsp;&nbsp;<apex:outputField id="accountCustomerBase" value="{!parentAccount.Customer_Base__c}"/></td>
            <td align="right">
               <FORM>
                  <INPUT TYPE="button" value = "print this page" onClick="window.print()"/>
               </FORM></td>
         </tr>
       </table>
      </apex:outputPanel>
       </apex:pageBlockSection>
    
    <!--  Account Objectives/Promotions --> 
    
    <apex:pageBlockSection id="AccountObjectives" columns="1" title="Current Objectives / Promotions" collapsible="false" >
        <apex:outputText escape="false" value="{!Objectives}"/>
    </apex:pageBlockSection>
    
    <!--  Activities -->
    <apex:pageBlockSection id="ActivityLog" columns="1" title="Activity Log"  collapsible="false">
            <apex:pageBlockTable value="{!Tasks}" var="t" rendered="{!showTasks}">
                <apex:column headerValue="Subject" >
                   <apex:outputLink value="/{!t.Id}">{!t.Subject}</apex:outputLink>
                </apex:column>
                <apex:column value="{!t.ActivityDate}" />
                <apex:column headerValue="Contact Name"  value="{!t.Who.Name}" />
                <apex:column value="{!t.Primary_Objective__c}" />
                <apex:column value="{!t.Secondary_Objective__c}" />
             </apex:pageBlockTable>
             
             <apex:pageBlockTable value="{!Events}" var="e" rendered="{!showEvents}">
                <apex:column headerValue="Subject" >
                   <apex:outputLink value="/{!e.Id}">{!e.Subject}</apex:outputLink>
                </apex:column>
                <apex:column value="{!e.StartDateTime}" />
                <apex:column headerValue="Contact Name"  value="{!e.Who.Name}" />
                <apex:column value="{!e.Primary_Objective__c}" />
                <apex:column value="{!e.Secondary_Objective__c}" />
             </apex:pageBlockTable>
             
     </apex:pageBlockSection> 
     
     <p>&nbsp;</p>
     
     <!-- Sales Status -->  
     
     <apex:pageBlockSection id="salesStatus" columns="1" title="Sales Status"  collapsible="false">
             <apex:outputText escape="false" value="{!SalesStatus}"/>
     </apex:pageBlockSection> 
     
     
     <p>&nbsp;</p>
     
     <!-- Product Roll-ups -->
     <apex:pageBlockSection columns="2" Id="salesByProduct"  collapsible="false">
     
       <apex:outputText escape="false" value="{!YtdSalesGrid}"/>
       
       <apex:pageBlockSectionItem >
          <div id="chart_div" style="text-align:left; border:1px solid black; width:300px;"/>
       </apex:pageBlockSectionItem>
       
     </apex:pageBlockSection>
     
     
     <!-- YTD New Sales -->
     <apex:pageBlockSection columns="2" Id="displaysSection"  collapsible="false">
       <apex:outputText escape="false" value="{!YtdSalesByProduct}"/>
       <apex:pageBlockSectionItem >
         <apex:image id="theImage" value="/servlet/servlet.FileDownload?file={!ImageId}" height="200" width="300"/>
       </apex:pageBlockSectionItem>         
     </apex:pageBlockSection>
     <apex:pageMessages />
  </apex:pageBlock>
</apex:page>