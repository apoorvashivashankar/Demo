<apex:page standardController="Account" extensions="AccountDashboardCtl" sidebar="false" showHeader="false">
   
   <head>  <!-- sidebar="false" header="false" -->
   <script type='text/javascript' src='https://www.google.com/jsapi' />  
   <script src="/soap/ajax/19.0/connection.js" type="text/javascript" />  
   <script type="text/javascript">  

   // use this function to format the label  
     formatCurrencyLabel = function( value )  
     {  
       return "$" + String(value);  
     }  
     google.load("visualization", "1", {packages:["corechart"]});  
     google.setOnLoadCallback(drawChart);  

     function drawChart() {  
         // Create a new data table with two columns: the label and the value  
         var data = new google.visualization.DataTable();  
         data.addColumn('string', 'Product Family');  
         data.addColumn('number', 'Sales');  
    
         // We need the sessionId to be able to query data  
        sforce.connection.sessionId = '{!$Api.Session_ID}';  
        // Query data using SOQL.  
        
         var result = sforce.connection.query("Select Product_Team__r.Name , sum( Net_Sales__c) netSales "+
                                              " From Sales__c s "+
                                              " where account__c in ({!allAccountsString})"+
                                              " and Year__c > {!LASTYEAR} " +
                                              <!-- " and SalesType__c = 'T' " + -->
                                              " group by Product_Team__r.Name ");  
         // Iterate over the result  
         
         var it = new sforce.QueryResultIterator(result); 
         
         while(it.hasNext()) {
             var record = it.next();  
             // Add the data to the table 
             var name = record.Name==""?"BLANK":record.Name; 
            data.addRow([name, {v:parseFloat(record.netSales), f: formatCurrencyLabel(record.netSales)}]);  
         }   
         var chart = new google.visualization.PieChart(document.getElementById('chart_div'));  
         chart.draw(data, {chartArea:{left:10,top:30,width:"90%",height:"90%"}, pieSliceText:'label', width: 300, height: 200, title: 'YTD Sales by Product Mix', is3D: true, legend:'right'});  
     }  
   </script>  
   </head>  
   
   
   <!--  Parent Account Info -->
    <apex:pageBlock id="mainBlock"> 
       <apex:pageBlockSection id="accountHeaderSection">
         <apex:outputField id="accountName" value="{!parentAccount.Name}"/>
         <apex:pageBlockSectionitem >
             <apex:outputLabel value="Account Number" for="accountNumber"/>
             <apex:outputField id="accountNumber" value="{!parentAccount.DW_ID__c}"/>
         </apex:pageBlockSectionitem>
         <!-- apex:outputField id="accountCustomerBase" value="{!parentAccount.Customer_Base__c}"/ -->
         <apex:pageBlockSectionitem id="accounOwnertNameItem">
             <apex:outputLabel value="Rep Name" for="accounOwnertName"/>
             <apex:outputField id="accounOwnertName" value="{!parentAccount.Owner.Name}"/>
         </apex:pageBlockSectionitem>
         <apex:pageBlockSectionitem id="pagePrintButton">
             <td align="right">
               <FORM>
                  <INPUT TYPE="button" value = "print this page" onClick="window.print() &&  window.close()"/>

               </FORM></td>
        </apex:pageBlockSectionitem>
       </apex:pageBlockSection>
    <hr/>
    <!--  Account Objectives/Promotions --> 
    
    <apex:pageBlockSection id="AccountObjectives" columns="1" title="Account Objectives / Promotions">
        <apex:outputPanel layout="block" style="overflow: auto; height: 100px;">
            <apex:outputText escape="false" value="{!Objectives}"/>
        </apex:outputPanel>    
    </apex:pageBlockSection>
    <hr/>
    <!--  Activities -->
    <apex:pageBlockSection id="ActivityLog" columns="1" title="Activity Log">
            <apex:pageBlockTable value="{!Tasks}" var="t" rendered="{!showTasks}">
                <apex:column headerValue="Subject" >
                   <apex:outputLink value="/{!t.Id}">{!t.Subject}</apex:outputLink>
                </apex:column>
                <apex:column value="{!t.ActivityDate}" />
                <apex:column value="{!t.Owner.Name}" />
                <apex:column value="{!t.Goals__c}" />
                <!-- apex:column value="{!t.Primary_Objective__c}" / -->
                <!-- apex:column value="{!t.Secondary_Objective__c}" / -->
             </apex:pageBlockTable>
             
             <apex:pageBlockTable value="{!Events}" var="e" rendered="{!showEvents}">
                <apex:column headerValue="Subject" >
                   <apex:outputLink value="/{!e.Id}">{!e.Subject}</apex:outputLink>
                </apex:column>
                <apex:column value="{!e.StartDateTime}" />
                <apex:column value="{!e.Owner.Name}" />
                <apex:column value="{!e.Goals__c}" />
                <!-- <apex:column value="{!e.Primary_Objective__c}" / -->
                <!-- <apex:column value="{!e.Secondary_Objective__c}" / -->
             </apex:pageBlockTable>
             
     </apex:pageBlockSection> 
     
     <hr/>
     <!-- Sales Status -->  
     
     <apex:pageBlockSection id="salesStatus" columns="1" title="YTD Sales Status">
             <apex:outputText escape="false" value="{!SalesStatus}"/>
     </apex:pageBlockSection> 
     
     

     <hr/>
     <!-- Product Roll-ups -->
     <apex:pageBlockSection columns="2" Id="salesByProduct">
     
       <apex:outputText escape="false" value="{!YtdSalesGrid}"/>
       
       <apex:pageBlockSectionItem >
          <div id="chart_div" style="text-align:left; border:1px solid black; width:300px;"/>
       </apex:pageBlockSectionItem>
       
     </apex:pageBlockSection>
     
     <hr/>
     <!-- Displays -->
     <apex:pageBlockSection columns="2" Id="displaysSection">
       
        <table border="0" width="400" >
            <tr>
               <th width="100%" style="font-weight:bold; color:white; background-color:darkblue;"><b><i>Display Vehicle Used</i></b>
               </th>
           </tr>
           <apex:repeat value="{!Displays}" var="d">
               <tr>
                   <td style="padding-left:40px;"><li>{!d}</li></td>
               </tr>
           </apex:repeat>
        </table>
       
        <apex:pageBlockSectionItem >
            <apex:outputText escape="false" value="{!YtdSalesByProduct}"/>
        </apex:pageBlockSectionItem>         
     </apex:pageBlockSection>
        
     <apex:pageMessages />
  </apex:pageBlock>
</apex:page>