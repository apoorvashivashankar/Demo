<!--
 - Created by ranja on 16-08-2018.
 -->

<aura:component description="Dal_Dist_SampleOrderProcess_Details" extends="c:Dal_Dist_SampleOrderBase" controller="Dal_ShipToAddressOverrideManager"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,forceCommunity:availableForAllPageTypes">

    <aura:attribute name="productOrderLines" type="Object" description="Selected products from modal" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name="baseModal" type="Map"/>
    <lightning:overlayLibrary aura:id="overlayLib"/>
    <aura:attribute name="currentPosition" type="Integer"/>

    <!--<aura:attribute name="primaryAddress" type="Map" />-->
    <aura:attribute name="addresses" type="List" default="[]"/>
    <aura:attribute name="showNewAddress" type="boolean" default="false"/>
    <aura:attribute name="states" type="List" default="[]"/>
    <aura:attribute name="countries" type="List" default="[]"/>
    <aura:attribute name="isLoading" type="Boolean" default="true"/>
    <aura:attribute name="newAddressInvalid" type="Boolean" default="false"/>
    <aura:attribute name="newAddressValidWithUpdate" type="Boolean" default="false"/>
    <aura:attribute name="isEditingExistingAddress" type="Boolean" default="false"/>

    <!-- shipping info -->
    <aura:attribute name="shipToName" type="String" default=""/>
    <aura:attribute name="shipToCareOf" type="String" default=""/>
    <aura:attribute name="shipToStreet1" type="String" default=""/>
    <aura:attribute name="shipToStreet2" type="String" default=""/>
    <aura:attribute name="shipToCity" type="String" default=""/>
    <aura:attribute name="shipToState" type="String" default=""/>
    <aura:attribute name="shipToZipcode" type="String" default=""/>
    <aura:attribute name="shipToCountry" type="String" default=""/>
    <aura:attribute name="wrapperData" type="Map" />
    <aura:attribute name="isMore" type="boolean" default="false" />

    <!-- internal attributes -->
    <aura:attribute name="isSaving" type="Boolean" default="false" />
    <aura:attribute name="isFormValid" type="Boolean" default="false"/>
    <aura:attribute name="savedOrdersUrl" type="String" default="{!$Label.c.Dal_Dist_OrderProcess_Details_SavedOrder_Label}"/>
	
    <!-- labels -->
    <aura:attribute name="labelHeader" type="String" default="Enter Order Details"/>
    <aura:attribute name="labelHeaderInfo" type="String" default="Instructions for this page would appear here."/>
    <aura:attribute name="labelBack" type="String" default="Back to skus"/>
    <aura:attribute name="labelSave" type="String" default="Save Order"/>
    <aura:attribute name="labelSaveContinue" type="String" default="Save and Continue"/>
    <aura:attribute name="labelShippingInfo" type="String" default="Shipping Info"/>
    <aura:attribute name="labelShipTo" type="String" default="Ship-To Address:"/>
    <aura:attribute name="labelChange" type="String" default="Change"/>
    <aura:attribute name="labelFreight" type="String" default="Freight Terms"/>
    <aura:attribute name="labelCarrier" type="String" default="Carrier"/>
    <aura:attribute name="labelSmallPackage" type="String" default="Ship as Small package?"/>
    <aura:attribute name="labelShipComplete" type="String" default="Ship Complete Order?"/>
    <aura:attribute name="labelOrderInfo" type="String" default="Order Info"/>
    <aura:attribute name="labelPoNumber" type="String" default="P.O. #"/>
    <aura:attribute name="labelJobName" type="String" default="Job Name"/>
    <aura:attribute name="labelContactName" type="String" default="Contact Name"/>
    <aura:attribute name="labelContactNumber" type="String" default="Contact Number"/>
    <aura:attribute name="labelCanShipSmallPackage" type="String" default="Small package shipping available for this order."/>
    <aura:attribute name="headerInfo" type="String" default="Please fill out shipping info and details for this order." />
    <aura:attribute name="sampleOrderHeaderInstructionalTextPageTwo" type="String" access="global"/>
    <aura:attribute name="sampleOrderHeaderTextPageTwo" type="String" access="global"  />

    <!-- Events -->
    <aura:registerEvent name="orderProcessEvt" type="c:Dal_Dist_OrderProcessStepEvt"/>
    <aura:handler event="c:Dal_ChooseShippingAddressEvt" action="{!c.handleChooseShippingAddressEvent}"/>
    <aura:handler event="c:Dal_Dist_OrderSaveEvt" action="{!c.handleSaveOrderEvent}"/>

    <lightning:layout verticalAlign="center" multipleRows="true" horizontalAlign="center" pullToBoundary="small">
        <lightning:layoutItem padding="around-small" size="12">
            <c:Peak_HTML_Headings headingTag="H2 - Section Heading" headingText="{!v.sampleOrderHeaderTextPageTwo}" />
        </lightning:layoutItem>
    </lightning:layout>

    <h5>{!v.sampleOrderHeaderInstructionalTextPageTwo}</h5>

    <lightning:layout class="orderContainer dal-form-order slds-m-vertical_x-large" verticalAlign="center" multipleRows="true" horizontalAlign="center">

        <!-- ******************** -->
        <!-- Form Header -->
        <!-- ******************** -->
        <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="12">
            <lightning:layout class="saveFooter slds-p-vertical_medium section-border-bottom" multipleRows="true" horizontalAlign="center" verticalAlign="center">

                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="4" largeDeviceSize="4" padding="horizontal-large">
                    <button class="slds-button dal-button-color_darkGray slds-text-heading_small" onclick="{!c.handleBack}">
                        <lightning:icon size="x-small" iconName="utility:chevronleft" /> BACK TO SKUS</button>
                </lightning:layoutItem>

                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="8" largeDeviceSize="8" class="slds-grid slds-grid_align-center
                                            slds-large-grid_align-end slds-medium-grid_align-end slds-order_1 slds-large-order_2 slds-p-top_large slds-p-bottom_small">
                    <div id="btnSaveContinue" class="saveAndContinueButtons">
                        <lightning:button variant="brand" label="SAVE AND CONTINUE" class="slds-m-horizontal_small" onclick="{!c.saveContinue}"  />
                    </div>
                </lightning:layoutItem>

            </lightning:layout>
        </lightning:layoutItem>
        <!-- ******************** -->
        <!-- End Form Header -->
        <!-- ******************** -->
        
        <!-- ******************** -->
        <!-- Shipping info -->
        <!-- ******************** -->
        <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="12">

            <lightning:layout multipleRows="true" pullToBoundary="small" class="slds-m-horizontal_small shippingInfo-border-bottom">
                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="2"  flexibility="auto">
                    <h4 class="bold">Shipping Info </h4>
                </lightning:layoutItem>

                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="10" class="slds-grid slds-wrap slds-p-top_xx-small">
                    <lightning:layout class="slds-size_12-of-12 slds-p-left_medium" multipleRows="true" pullToBoundary="small">

                        <lightning:layoutItem size="12" class="slds-grid slds-m-bottom_small">
                            <div class="orderOutputData orderOutputData-stacked">
                                <label>{!v.labelShipTo}</label>
                                <span>{!v.shipToName}<br/>
                                    <aura:if isTrue="{!!empty(v.shipToCareOf)}">{!v.shipToCareOf}<br/></aura:if>
                                    <aura:if isTrue="{!!empty(v.shipToStreet1)}">{!v.shipToStreet1}<br/></aura:if>
                                    <aura:if isTrue="{!!empty(v.shipToStreet2)}">{!v.shipToStreet2}<br/></aura:if>
                                    {!v.shipToCity},&nbsp;{!v.shipToState}&nbsp;{!v.shipToZipcode}&nbsp;{!v.shipToCountry}
                                </span>
                            </div>
                            <div class="slds-p-horizontal_large" >
                                <a href="javascript:void(0);" onclick="{!c.changeShippingAddress}">Change</a>
                            </div>
                        </lightning:layoutItem>

                        <lightning:layoutItem size="12" class="{!'slds-grid slds-wrap slds-p-top_large' + ((v.canShipSmallPackage == false) ? ' slds-p-bottom_large' : '')}">
                            <div class="slds-size_10-of-12 slds-medium-size_8-of-12 slds-small-size_10-of-12 slds-large-size_4-of-12">
                                <lightning:select name="freightInput" label="Freight Terms" class="slds-p-around_x-small input-large slds-m-right_large"
                                                  value="{!v.freightTerms}" onchange="{!c.handleChange}">
                                    <option value="1A1">Prepaid</option>
                                    <!--<option value="1A2">Prepaid &#38; add</option>-->
                                    <!--<option value="1A3">Collect</option>-->
                                </lightning:select>
                            </div>

                            <!--
                            <div class="slds-size_4-of-12">
                                <lightning:select aura:id="shipCompleteInput" name="shipCompleteInput" label="Ship Complete Order?"
                                                  class="slds-p-around_x-small input-large" value="{!v.isShipComplete}" required="true" messageWhenValueMissing="Required" >
                                    <aura:if isTrue="{!empty(v.isShipComplete)}">
                                        <option value=""></option>
                                    </aura:if>
                                    <option value="no">No, ship as tile becomes available</option>
                                    <option value="yes">Yes, ship when all tile is available</option>
                                </lightning:select>
                            </div>
                            -->
                        </lightning:layoutItem>

                        <aura:if isTrue="{!v.isSearching == true}">
                            <lightning:layoutItem size="12" class="">
                                <lightning:layout class="slds-is-relative">
                                    <lightning:spinner class="spinner-fixed" variant="brand" />
                                </lightning:layout>
                            </lightning:layoutItem>
                        </aura:if>


                        <!-- can ship via a small package carrier for this order -->
                        <!--<aura:if isTrue="{!!(v.cumulativeOrderWeight >150)}">-->
                        <aura:if isTrue="{!v.isMore == false}">
                            <lightning:layoutItem size="12" class="slds-grid slds-wrap slds-p-horizontal_x-small slds-p-top_medium slds-p-bottom_xx-small">
                                <p>Small package shipping available for this order.</p>
                            </lightning:layoutItem>

                            <lightning:layoutItem size="12" class="slds-grid slds-wrap slds-p-bottom_large">
                                <div class="slds-size_10-of-12 slds-medium-size_8-of-12 slds-small-size_10-of-12 slds-large-size_4-of-12">
                                    <lightning:select aura:id="shipSmallPackageInput" name="shipSmallPackageInput" label="Ship as Small package?"
                                                      class="slds-p-around_x-small input-large slds-m-right_large" value="{!v.isSmallPackage}"
                                                      onchange="{!c.handleSmallPackageShipChange}" >
                                        <aura:if isTrue="{!empty(v.isSmallPackage)}">
                                            <option value=""></option>
                                        </aura:if>
                                        <option value="no">No - Ship via standard freight</option>
                                        <option value="yes">Yes - Ship via Small Package Carrier</option>
                                    </lightning:select>
                                </div>
                                <aura:if isTrue="{!v.isSmallPackage == 'yes'}">
                                    <div class="slds-size_4-of-12">
                                        <lightning:select aura:id="smallPackageSelect" name="carrierInput" label="{!v.labelCarrier}"
                                                          class="slds-p-around_x-small input-large" value="{!v.carrier}" >
                                            <option value="UPS Ground">UPS Ground</option>
                                            <option value="UPS Residential Ground">UPS Residential Ground</option>
                                        </lightning:select>
                                    </div>
                                </aura:if>

                            </lightning:layoutItem>
                        </aura:if>
                        <!--</aura:if>-->

                    </lightning:layout>
                </lightning:layoutItem>
            </lightning:layout>
        </lightning:layoutItem>
        <!-- ******************** -->
        <!-- End shipping info -->
        <!-- ******************** -->

        <!-- ******************** -->
        <!-- Order info -->
        <!-- ******************** -->
        <lightning:layoutItem class="section-border-bottom" padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="12">

            <lightning:layout multipleRows="true" pullToBoundary="small" class="slds-m-horizontal_small">
                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="2"  flexibility="auto">
                    <div class="slds-p-vertical_small">
                        <h4 class="bold">Order Info </h4>
                    </div>
                </lightning:layoutItem>

                <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="10" class="slds-grid slds-wrap">
                    <lightning:layout multipleRows="true" pullToBoundary="small" class="slds-size_12-of-12 slds-p-left_medium">
                        <lightning:layoutItem size="12" class="slds-grid slds-wrap slds-size_12-of-12">
                            <div class="slds-is-relative slds-size_10-of-12 slds-medium-size_8-of-12 slds-small-size_10-of-12 slds-large-size_4-of-12">
                                <lightning:input aura:id="poNumberInput" label="P.O. #" name="poNumberInput" class="slds-p-horizontal_small input-large"
                                                 value="{!v.poNumber}" maxlength="35"
                                                 pattern="[0-9a-zA-Z]+[0-9a-zA-Z ]+" messageWhenPatternMismatch="No special characters are allowed."  />
                            </div>
                        </lightning:layoutItem>

                        <lightning:layoutItem size="12" class="slds-grid slds-wrap slds-p-bottom_medium slds-size_12-of-12">
                            <div class="slds-is-relative slds-size_10-of-12 slds-medium-size_8-of-12 slds-small-size_10-of-12 slds-large-size_4-of-12">
                                <lightning:input label="Job Name" name="quantityInput" class="slds-p-around_small input-large" value="{!v.jobName}" maxlength="40"  />

                            </div>
                        </lightning:layoutItem>
                    </lightning:layout>
                </lightning:layoutItem>

            </lightning:layout>
        </lightning:layoutItem>
        <!-- ******************** -->
        <!-- End order info -->
        <!-- ******************** -->
        <!-- ******************** -->

        <!-- ******************** -->
        <!-- Save/Continue -->
        <!-- ******************** -->
        <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="12">
            <lightning:layout class="saveFooter slds-p-vertical_medium" multipleRows="true" horizontalAlign="center" verticalAlign="center">
                <lightning:layoutItem size="12" class="slds-grid slds-grid_align-center slds-large-grid_align-end slds-medium-grid_align-end slds-order_1 slds-large-order_2 slds-p-top_large slds-p-bottom_small">
                    <div id="btnSaveContinue" class="saveAndContinueButtons">
                        <lightning:button variant="brand" label="SAVE AND CONTINUE" class="slds-m-horizontal_small"
                                          onclick="{!c.saveContinue}" />
                    </div>
                </lightning:layoutItem>
            </lightning:layout>
        </lightning:layoutItem>
        <!-- ******************** -->
        <!-- End save/Continue -->
        <!-- ******************** -->

    </lightning:layout>


</aura:component>