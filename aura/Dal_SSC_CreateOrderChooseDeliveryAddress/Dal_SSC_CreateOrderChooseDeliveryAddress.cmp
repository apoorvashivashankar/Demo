<!--
 - Created by ranja on 14-01-2019.
 -->

<aura:component description="Dal_SSC_CreateOrderChooseDeliveryAddress" extends="c:Dal_ModalBase"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
                access="global" controller="Dal_InventorySearchController">

    <aura:handler name="init" action="{!c.init}" value="{!this}"/>

    <!-- internal attributes -->
    <lightning:overlayLibrary aura:id="overlayLib"/>
    <aura:attribute name="primaryAddress" type="Map"/>
    <aura:attribute name="addresses" type="List" default="[]"/>
    <aura:attribute name="showNewAddress" type="boolean" default="false"/>
    <aura:attribute name="statesList" type="List" default="[]"/>
    <aura:attribute name="countries" type="List" default="[]"/>
    <aura:attribute name="isLoading" type="Boolean" default="true"/>
    <aura:attribute name="newAddressInvalid" type="Boolean" default="false"/>
    <aura:attribute name="newAddressValidWithUpdate" type="Boolean" default="false"/>
    <aura:attribute name="isEditingExistingAddress" type="Boolean" default="false"/>
    <aura:attribute name="wrapperData" type="Map"/>
    <aura:attribute name="newAddressId" type="String" default=""/>
    <aura:attribute name="selectedAddress" type="Object" description="Selected address from modal"/>
    <aura:attribute name="addressError" type="String" default="Please enter correct city or country."/>
    <aura:attribute name="isaddressError" type="Boolean" default="false"/>

    <!-- events -->
    <aura:registerEvent name="chooseShippingAddressEvt" type="c:Dal_SSC_CreateOrderSaveShippingAddress"/>

    <aura:attribute name="isNewAddress" type="boolean" default="false"/>
    <aura:attribute name="listOfAddress" type="List" default="1,2,3,4,5"/>
    <aura:attribute name="currentPosition" type="Integer"/>


    <!--Delivery Attributes-->
    <!-- Labels -->
    <aura:attribute name="searchProductModalTitle" type="String" default="Delivery Address"
                    description="Delivery Address"/>
    <aura:attribute name="newCompanyName" type="String" default=""/>
    <aura:attribute name="newAddressStreet1" type="String" default=""/>
    <aura:attribute name="newAddressCity" type="String" default=""/>
    <aura:attribute name="newAddressState" type="String" default=""/>
    <aura:attribute name="newAddressZipcode" type="String" default=""/>
    <aura:attribute name="newAddressCountry" type="String" default=""/>

    <aura:attribute name="isMore" type="boolean" default="false"/>

    <aura:attribute name="newCompanyAdjustedName" type="String" default=""/>
    <aura:attribute name="newAddressAdjustedStreet1" type="String" default=""/>
    <aura:attribute name="newAddressAdjustedCity" type="String" default=""/>
    <aura:attribute name="newAddressAdjustedState" type="String" default=""/>
    <aura:attribute name="newAddressAdjustedZipcode" type="String" default=""/>
    <aura:attribute name="newAddressAdjustedCountry" type="String" default=""/>
    <aura:attribute name="orderNumber" type="String" default="order1"/>


    <header class="slds-grid slds-p-horizontal_x-large slds-p-bottom_medium">
        <lightning:layout multipleRows="true" verticalAlign="center" class="slds-size_12-of-12">
            <c:Peak_HTML_Headings headingTag="H2 - Section Heading"
                                  headingText="{!v.searchProductModalTitle}"/>
        </lightning:layout>
    </header>


    <!-- MODAL BODY -->
    <lightning:layout class="slds-p-vertical_small" multipleRows="true">

        <aura:if isTrue="{!v.isLoading != true}">
            <aura:if isTrue="{!v.showNewAddress == false}">

                <!-- show add new address form -->
                <aura:set attribute="else">

                    <!-- show enter new address container -->
                    <aura:if isTrue="{!v.newAddressValidWithUpdate == false}">

                        <!-- new address form -->
                        <lightning:layoutItem class="dal-form-order" size="12">
                            <lightning:layout multipleRows="true">

                                <!-- invalid address  -->
                                <aura:if isTrue="{!v.newAddressInvalid}">
                                    <lightning:layoutItem class="slds-p-horizontal_small slds-p-vertical_x-small"
                                                          size="12">
                                        <ui:message class="dal-uiMessage slds-p-horizontal_medium slds-p-vertical_small"
                                                    severity="warning"
                                                    closable="false">Address validation failed. Please edit provided
                                            address.
                                        </ui:message>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- end invalid address -->



                                <!--New MY ADDRESS-->
                                <div class="dal-delivery-modal slds-size_8-of-12 ">
                                    <div class="dal-delivery-address">

                                        <lightning:input aura:id="companyName" class="slds-m-bottom_large"
                                                         name="companyName" label="Company Name (Optional)"
                                                         value="{!v.newCompanyName}" maxlength="50" required="true"/>
                                        <lightning:input aura:id="street1" class="slds-m-bottom_large"
                                                         name="streetAddress" label="Street Address"
                                                         maxlength="75" required="true"
                                                         value="{!v.newAddressStreet1}"/>
                                        <lightning:input aura:id="city" class="slds-m-bottom_large" name="city"
                                                         maxlength="50" required="true" label="City"
                                                         value="{!v.newAddressCity}"/>

                                        <div class="slds-grid slds-wrap">

                                            <div class="slds-col slds-size_5-of-12">
                                                <lightning:select aura:id="state" name="state" label="State"
                                                                  required="true"
                                                                  value="{!v.newAddressState}">
                                                    <aura:if isTrue="{!not(v.newAddressState)}">
                                                        <option value="">Select State</option>
                                                    </aura:if>
                                                    <aura:iteration items="{!v.statesList}" var="item">
                                                        <option value="{!item.value}">{!item.label}</option>
                                                    </aura:iteration>
                                                </lightning:select>
                                            </div>

                                            <div class="slds-col slds-size_2-of-12">
                                            </div>
                                            <div class="slds-col slds-size_5-of-12">
                                                <span>
                                                    <lightning:input type="text" aura:id="zipcode" name="zipcode"
                                                                     label="Zip Code" value="{!v.newAddressZipcode}"
                                                                     required="true" maxlength="10"
                                                                     messageWhenPatternMismatch="Enter valid zip code"/>
                                                </span>
                                            </div>
                                        </div>
                                        <lightning:select aura:id="country" class="slds-m-top_large" name="Country" label="Country" required="true" value="{!v.newAddressCountry}">
                                            <option value=""></option>
                                            <aura:iteration items="{!v.countries}" var="item">
                                                <option value="{!item}">{!item}</option>
                                            </aura:iteration>
                                        </lightning:select>
                                    </div>

                                    <div class="dal-delivery-address-footer slds-m-left_small">
                                        <lightning:button label="CHANGE ADDRESS"
                                                          class="dal-delivery-address-button-change"
                                                          title="CHANGE ADDRESS" variant="destructive"
                                                          onclick="{!c.handleSaveAddress}"/>
                                        <br/>
                                        <lightning:button class="dal-delivery-address-button-cancel"
                                                          variant="base" label="Cancel"
                                                          title="Cancel" onclick="{! c.handleClose }"/>
                                    </div>
                                </div>
                            </lightning:layout>
                        </lightning:layoutItem>
                        <!-- end address input -->
                        <!-- end new address form -->


                        <!-- new address starts -->
                        <aura:if isTrue="{!not(v.newAddressValidWithUpdate == false)}">
                            <lightning:layoutItem size="12">
                                <lightning:layout
                                        class="footer-bar-newAddress slds-m-top_medium slds-border_top slds-p-top_small slds-p-horizontal_large"
                                        horizontalAlign="end">
                                    <lightning:layoutItem class="slds-p-right_small">
                                        <lightning:button variant="neutral" label="Cancel" onclick="{!c.handleCancel}"/>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem>
                                        <lightning:button variant="brand" label="Save Address"
                                                          onclick="{!c.handleSaveAddress}"/>
                                    </lightning:layoutItem>
                                </lightning:layout>
                            </lightning:layoutItem>
                        </aura:if>
                        <!-- end new address starts -->
                    </aura:if>
                    <!-- end show enter new address container -->

                    <!-- new address is valid with update -->
                    <aura:if isTrue="{!v.newAddressValidWithUpdate == true}">
                        <lightning:layoutItem class="dal-form-order slds-p-horizontal_small" size="12">
                            <lightning:layout multipleRows="true">

                                <lightning:layoutItem class="slds-p-around_x-small slds-p-bottom_medium" size="12">
                                    <ui:message class="dal-uiMessage slds-p-horizontal_medium slds-p-vertical_small"
                                                severity="warning" closable="false">Address validation failed. You can
                                        use the adjusted address, or edit the provided address.
                                    </ui:message>
                                </lightning:layoutItem>

                                <lightning:layoutItem class="slds-p-around_x-small" size="12" smallDeviceSize="12"
                                                      mediumDeviceSize="6" largeDeviceSize="6">
                                    <h3 class="slds-p-bottom_x-small">Entered Address</h3>

                                    <lightning:layout class="slds-tile fix-height" multipleRows="true">

                                        <lightning:layoutItem size="12">
                                            <aura:if isTrue="{!!empty(v.newCompanyName)}"><h3
                                                        class="slds-tile__title">{!v.newCompanyName}</h3></aura:if>
                                            <div class="slds-tile__detail">
                                                <aura:if isTrue="{!!empty(v.newAddressStreet1)}">
                                                    <p>{!v.newAddressStreet1}</p></aura:if>
                                                <p>{!v.newAddressCity},&nbsp;{!v.newAddressState}
                                                    &nbsp;{!v.newAddressZipcode} &nbsp; {!v.newAddressCountry}</p>
                                            </div>
                                            <lightning:button variant="neutral" label="Edit this address"
                                                              onclick="{!c.editValidationAddress}"/>
                                            <lightning:icon class="bkg-map" iconName="utility:location" size="large"/>
                                        </lightning:layoutItem>

                                    </lightning:layout>

                                </lightning:layoutItem>

                                <lightning:layoutItem class="slds-p-around_x-small " size="12" smallDeviceSize="12"
                                                      mediumDeviceSize="6" largeDeviceSize="6">
                                    <h3 class="slds-p-bottom_x-small">Adjusted Address</h3>


                                    <lightning:layout class="slds-tile fix-height" multipleRows="true">

                                        <lightning:layoutItem size="12">
                                            <aura:if isTrue="{!!empty(v.newCompanyAdjustedName)}"><h3
                                                        class="slds-tile__title">{!v.newCompanyAdjustedName}</h3>
                                            </aura:if>
                                            <div class="slds-tile__detail">
                                                <aura:if isTrue="{!!empty(v.newAddressAdjustedStreet1)}">
                                                    <p>{!v.newAddressAdjustedStreet1}</p></aura:if>
                                                <p>{!v.newAddressAdjustedCity},&nbsp;{!v.newAddressAdjustedState}
                                                    &nbsp;{!v.newAddressAdjustedZipcode} &nbsp;{!v.newAddressAdjustedCountry}</p>
                                            </div>
                                            <lightning:button variant="brand" label="Use this address"
                                                              onclick="{!c.useUpdatedAddress}"/>
                                            <lightning:icon class="bkg-map" iconName="utility:location" size="large"/>
                                        </lightning:layoutItem>

                                    </lightning:layout>
                                </lightning:layoutItem>
                            </lightning:layout>
                        </lightning:layoutItem>
                    </aura:if>
                    <!-- end new address is valid with update -->

                </aura:set>
                <!-- end show add new address form -->

            </aura:if>

            <!-- show loading -->
            <aura:set attribute="else">
                <lightning:layoutItem class="slds-m-top_xx-large slds-m-bottom_large slds-is-relative" size="12">
                    <ui:message class="dal-uiMessage slds-p-horizontal_medium slds-p-vertical_small"
                                severity="warning" closable="false">{!v.addressError}</ui:message>

                </lightning:layoutItem>
            </aura:set>
            <!-- end show loading -->

        </aura:if>
        <!-- end new address is valid with update -->

    </lightning:layout>
</aura:component>